var u=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var p=u((ze,I)=>{var ie=class{constructor(e,r,n){this.filename=e,this.lineNumber=r,this.description=n}};I.exports=ie});var h=u((Ke,F)=>{var S=require("path"),ce={filenames:{calendar:"calendar.txt",recurring:"recurring.txt",archive:".calendar-archive.txt"},absolute_paths:{"calendar.txt":S.resolve(process.env.LIFE_DIR,"calendar.txt"),"recurring.txt":S.resolve(process.env.LIFE_DIR,"recurring.txt"),".calendar-archive.txt":S.resolve(process.env.LIFE_DIR,".calendar-archive.txt")}};F.exports=ce});var R=u((Ve,L)=>{var B=require("fs"),Qe=require("path"),_=p(),ue=h(),de=e=>{let r=ue.absolute_paths[e];if(!B.existsSync(r))return new _(e,0,`~/life/${e} not exists, create it with touch`);let t=B.readFileSync(r,"utf-8").split(`
`).map((s,o)=>({lineNumber:o+1,content:s.trim()})).filter(s=>s.content!==""),a=[],i={currentBlock:null};for(let s of t)if(s.content[0]!=="+"){let o={header:s,body:[]};a.push(o),i.currentBlock=o;continue}else{if(!i.currentBlock)return new _(e,s.lineNumber,"Blocks can't start with +");i.currentBlock.body.push(s);continue}return a};L.exports=de});var q=u((Xe,O)=>{var le=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];O.exports=le});var v=u((Ze,M)=>{var me=R(),w=p(),b=h(),U=q(),fe=e=>{let r=e.content.split(" ");if(r.length!==2)return new w(b.filenames.calendar,e.lineNumber,"a day calendar header must habe format: dd-mm-yy dayname");let[n,t]=r,a=n.split("-").map(E=>+E);if(a.length!==3||a.some(Number.isNaN))return new w(b.filenames.calendar,e.lineNumber,"a day calendar header must habe format: dd-mm-yy dayname");let[i,s,o]=a;if(i<1||i>31||s<1||s>12||!U.includes(t.toLowerCase().trim()))return new w(b.filenames.calendar,e.lineNumber,"a day calendar header must habe format: dd-mm-yy dayname");let d=new Date(o,s-1,i),c=U[d.getDay()];return t!==c?new w(b.filenames.calendar,e.lineNumber,"a day calendar header must habe format: dd-mm-yy dayname"):d},ye=()=>{let e=me(b.filenames.calendar);if(e instanceof w)return e;let r=[];for(let n of e){let t=fe(n.header);if(t instanceof w)return t;let a=r[r.length-1];if(a&&a.date>=t)return new w(b.filenames.calendar,n.header.lineNumber,"The days are out of order or duplicated.");r.push({...n,date:t})}return r};M.exports=ye});var C=u((er,H)=>{var f=p(),pe=R(),g=h(),ge=q(),he=e=>{let r=e.content.split(" ");if(r.length>2||r.length<1)return new f(g.filenames.recurring,e.lineNumber,"No tag in the \u201Crecurring.txt\u201D file accepts more than one argument.");if(r[0]==="@daily")return r.length!==1?new f(g.filenames.recurring,e.lineNumber,"@daily tags do not take arguments"):{tag:"@daily"};if(r[0]==="@weekly"){let n=r[1]||"monday";return ge.includes(n)?{tag:"@weekly",dayname:n}:new f(g.filenames.recurring,e.lineNumber,"The @weekly tags only accept days of the week as arguments. If no parameter is provided, Monday is assumed.")}if(r[0]==="@monthly"){let n=r[1]?+r[1]:1;return Number.isNaN(n)||n<0||n>31?new f(g.filenames.recurring,e.lineNumber,"The @monthly tags only receive the number of the day of the month as an argument, or, failing that, no argument is assumed to be the 1st day."):{tag:"@monthly",daynumber:n}}if(r[0]==="@yearly"){let n=r[1]?r[1].split("-"):["1","1"];if(n.length!==2)return new f(g.filenames.recurring,e.lineNumber,"The @yearly tags only accept one argument in dd-mm format; otherwise, 1-1 is assumed.");let[t,a]=n.map(i=>+i);return[t,a].some(Number.isNaN)||t<1||t>31||a<1||a>12?new f(g.recurring,e.lineNumber,"The @yearly tags only accept one argument in dd-mm format; otherwise, 1-1 is assumed."):{tag:"@yearly",daynumber:t,monthnumber:a}}return new f(g.filenames.recurring,e.lineNumber,"The only valid tags are @daily, @weekly, @monthly, or @yearly.")},we=()=>{let e=pe(g.filenames.recurring);if(e instanceof f)return e;let r=[];for(let n of e){let t=he(n.header);if(t instanceof f)return t;r.push({...n,timeRule:t})}return r};H.exports=we});var Y=u((rr,j)=>{var be=v(),De=C(),N=p(),y=()=>{let e=be();if(e instanceof N)return e;let r=De();if(r instanceof N)return r},D="\x1B[0m",Ee="\x1B[1m",qe="\x1B[31m",ve="\x1B[33m",Ne="\x1B[36m",xe="\x1B[2m",Se="\x1B[32m",P=`${Ee}${qe}LifeScript error:${D}`;y.printError=e=>{if(e instanceof N){let r=`${Ne}${e.filename}${D}:${ve}${e.lineNumber}${D}`;console.error(`${P} ${r}`),console.error(`  ${e.description}`),console.error(`${xe}  (check the line indicated in your file)${D}`);return}};y.printCongratulations=()=>{console.log(`${Se}No errors were found in your life-script file system.${D}`)};y.logCommandError=e=>{console.log(P),console.error(`  ${e}${D}`)};y.printErrorIfIsError=e=>{e instanceof N&&y.printError(e)};y.printErrorOrCongratulations=e=>{e instanceof N?y.printError(e):y.printCongratulations()};j.exports=y});var z=u((nr,W)=>{var A=require("fs").promises,G=h(),Re=v(),Ce=p(),$e=q(),Te=e=>{let r=e.getDate(),n=e.getMonth()+1,t=e.getFullYear(),a=$e[e.getDay()];return`${r}-${n}-${t} ${a}`},ke=async e=>{let r=Re();if(r instanceof Ce)return r;let n=r.map(s=>s.date);if(n.length===0){let s=new Date,o=new Date(s);o.setDate(s.getDate()-1),n.push(o)}let t=n[n.length-1],a=Array.from({length:e},(s,o)=>{let d=new Date(t);return d.setDate(t.getDate()+o+1),d}).map(Te).join(`

`),i=G.absolute_paths[G.filenames.calendar];await A.appendFile(i,`

`,"utf-8"),await A.appendFile(i,a,"utf-8")};W.exports=ke});var $=u((tr,J)=>{var Ie=e=>e.map(r=>[r.header.content,...r.body.map(n=>n.content)].join(`
`)).join(`

`);J.exports=Ie});var ee=u((ar,Z)=>{var Fe=v(),K=p(),Q=require("fs").promises,V=require("fs"),x=h(),X=$(),T=x.absolute_paths[x.filenames.archive],Be=x.absolute_paths[x.filenames.calendar],_e=async()=>{V.existsSync(T)||V.writeFileSync(T,"","utf-8");let e=Fe();if(e instanceof K)return K;let r=[],n=[];for(let o of e){let d=new Date,c=new Date(d);c.setDate(d.getDate()-1),o.date<c?r.push(o):n.push(o)}let t=X(r),a=X(n),i=Q.appendFile(T,`

`+t,"utf-8"),s=Q.writeFile(Be,a,"utf-8");await Promise.all([i,s])};Z.exports=_e});var se=u((sr,ae)=>{var Le=require("fs").promises,re=h(),Oe=v(),Ue=C(),ne=p(),te=$(),Me=q(),He=async()=>{let e=Oe();if(e instanceof ne)return e;let r=Ue();if(r instanceof ne)return r;let n=[],t=[],a=new Date;a.setHours(0,0,0,0);for(let c of e)c<a?n.push(c):t.push(c);let i=t.map(c=>{let E={...c,body:[...c.body]};for(let m of r)(m.timeRule.tag==="@daily"||m.timeRule.tag==="@weekly"&&Me[c.date.getDay()]===m.timeRule.dayname||m.timeRule.tag==="@monthly"&&c.date.getDate()===m.timeRule.daynumber||m.timeRule.tag==="@yearly"&&c.date.getMonth()===m.timeRule.monthnumber-1&&c.date.getDate()===m.timeRule.daynumber)&&m.body.forEach(k=>{E.body.some(oe=>oe.content===k.content)||E.body.push(k)});return E}),s=te(n),o=te(i),d=s+`

`+o;await Le.writeFile(re.absolute_paths[re.filenames.calendar],d,"utf-8")};ae.exports=He});var l=Y(),Pe=z(),je=ee(),Ye=se(),Ae=require("fs"),Ge=async()=>{if(!Ae.existsSync(process.env.LIFE_DIR))return l.logCommandError("~/life dir not exists, create it with mkdir");if(process.argv[2]==="diagnostic")return process.argv.length!==3?l.logCommandError("This command does not require any arguments."):l.printErrorOrCongratulations(l());if(process.argv[2]==="add-calendar-days"){let e=+process.argv[3];return typeof e!="number"||Number.isNaN(e)||process.argv.length>4?l.logCommandError("The \u201Cadd-calendar-days\u201D command can only receive a numeric argument."):l.printErrorIfIsError(await Pe(e))}if(process.argv[2]==="archive-calendar")return process.argv.length!==3?l.logCommandError("This command does not require any arguments."):l.printErrorIfIsError(await je());if(process.argv[2]==="push-recurring")return process.argv.length!==3?l.logCommandError("This command does not require any arguments."):l.printErrorIfIsError(await Ye())};Ge();
